<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>پنل مدیریت نظرات</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {font-family:Tahoma,sans-serif;direction:rtl;background:#f5f7fa;margin:0;padding:20px}
    h1 {text-align:center;color:#00796b}
    table {width:100%;border-collapse:collapse;margin-top:20px;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.1)}
    th,td {padding:12px;border-bottom:1px solid #ddd;text-align:center}
    th {background:#00bcd4;color:#fff}
    tr:hover {background:#f1f1f1}
    button {padding:6px 12px;border:none;border-radius:6px;cursor:pointer;font-weight:bold;margin:2px}
    .approve {background:#4caf50;color:#fff}
    .delete {background:#f44336;color:#fff}
    .reject {background:#ff9800;color:#fff}
  </style>
</head>
<body>
  <h1>پنل مدیریت نظرات</h1>
  <table>
    <thead>
      <tr>
        <th>نام کاربر</th>
        <th>پزشک</th>
        <th>نظر</th>
        <th>تاریخ</th>
        <th>وضعیت</th>
        <th>عملیات</th>
      </tr>
    </thead>
    <tbody id="comments-body"></tbody>
  </table>

  <script>
    const client = supabase.createClient(
      'https://YOUR_PROJECT.supabase.co',
      'YOUR_ANON_PUBLIC_KEY'
    );

    async function loadComments(){
      const { data, error } = await client
        .from('comments')
        .select('*')
        .order('created_at',{ascending:false});
      if(error){ console.error(error); return; }

      const tbody = document.getElementById('comments-body');
      tbody.innerHTML='';
      data.forEach(row=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td>${row.user_name}</td>
          <td>${row.doctor_name}</td>
          <td>${row.comment}</td>
          <td>${new Date(row.created_at).toLocaleString('fa-IR')}</td>
          <td>${row.approved ? '✅ تأیید شده' : '⏳ در انتظار'}</td>
          <td>
            <button class="approve" onclick="approveComment(${row.id})">تأیید</button>
            <button class="reject" onclick="rejectComment(${row.id})">رد</button>
            <button class="delete" onclick="deleteComment(${row.id})">حذف</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function approveComment(id){
      await client.from('comments').update({approved:true}).eq('id',id);
      loadComments();
    }

    async function rejectComment(id){
      await client.from('comments').update({approved:false}).eq('id',id);
      loadComments();
    }

    async function deleteComment(id){
      if(!confirm('آیا مطمئن هستید؟')) return;
      await client.from('comments').delete().eq('id',id);
      loadComments();
    }

    loadComments();
  </script>
</body>
</html>